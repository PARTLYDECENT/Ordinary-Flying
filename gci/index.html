<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TentacleOS v2.3.8 - DARPA Neural Interface // PRIMARCH_PROTOCOL_ACTIVE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono:wght@400&family=Courier+Prime:wght@400;700&display=swap');
        :root {
            --blood-red: #8B0000; --crimson: #DC143C; --bone-white: #F5F5DC; --ash-gray: #2F2F2F; 
            --electric-cyan: #00FFFF; --void-black: #000000; --rust-orange: #B7410E; --toxic-green: #39FF14; 
            --neural-blue: #0080FF; --glitch-pink: #FF00FF; --warning-yellow: #FFD700; --decay-brown: #654321;
            --desktop-bg: #000000; --taskbar-bg: rgba(10, 10, 10, 0.95); --window-bg: rgba(8, 8, 8, 0.9);
            --retro-amber: #FFB000; --retro-green: #00FF41; --crt-blue: #4DFFFF;
            --primarch-gold: #DAA520; --darpa-purple: #301934; --alien-teal: #008080; --biomech-orange: #FF4500;
            --tentacle-deep: #0a0014; --neural-pulse: #0066CC; --quantum-violet: #8A2BE2; --synaptic-lime: #CCFF00;
            --backrooms-yellow: #e9dcc9; --backrooms-tan: #d4c4a0; --backrooms-brown: #a0826d;
            --phase-indicator: #00FF41;
            --linux-red: #cc0000; --linux-blue: #0073e6; --retro-phosphor: #00ff00; --amber-terminal: #ffb000;
            --midnight-blue: #191970; --deep-purple: #1e0033; --tentacle-purple: #2d1b69;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Share Tech Mono', 'VT323', 'Courier Prime', monospace;
            background: var(--desktop-bg); color: var(--bone-white);
            overflow: hidden; height: 100vh;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8 0 L16 8 L8 16 L0 8 Z" fill="none" stroke="lime" stroke-width="1.5"/><circle cx="8" cy="8" r="1" fill="lime"/></svg>'), auto;
        }
        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(0, 255, 0, 0.02) 1px, rgba(0, 255, 0, 0.02) 2px),
                radial-gradient(circle at 50% 50%, transparent 0%, rgba(0, 0, 0, 0.1) 100%);
            animation: scanlines 0.15s linear infinite;
            mix-blend-mode: screen;
        }
        @keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 2px; } }
        
        .desktop-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; transition: all 3s ease-in-out; }
        
        .desktop-bg.phase-0 {
            background: 
                radial-gradient(circle at 20% 30%, rgba(139, 0, 0, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(45, 27, 105, 0.6) 0%, transparent 35%),
                radial-gradient(circle at 50% 20%, rgba(30, 0, 51, 0.5) 0%, transparent 30%),
                radial-gradient(circle at 30% 80%, rgba(25, 25, 112, 0.3) 0%, transparent 40%),
                linear-gradient(135deg, #000000, #0a0014, #1e0033, #000508, #2d1b69, #000000);
            animation: tentacle-pulse 20s ease-in-out infinite alternate, tentacle-writhe 45s linear infinite;
        }
        
        @keyframes tentacle-pulse { 
            0% { filter: hue-rotate(0deg) brightness(0.6) contrast(1.3) saturate(0.9); } 
            25% { filter: hue-rotate(-10deg) brightness(0.4) contrast(1.5) saturate(1.1); }
            50% { filter: hue-rotate(15deg) brightness(0.3) contrast(1.8) saturate(0.7); }
            75% { filter: hue-rotate(-5deg) brightness(0.5) contrast(1.4) saturate(1.2); }
            100% { filter: hue-rotate(0deg) brightness(0.6) contrast(1.3) saturate(0.9); } 
        }
        
        @keyframes tentacle-writhe {
            0% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%; }
            25% { background-position: -20% 10%, 15% -5%, 5% 15%, -10% 5%, 0% 0%; }
            50% { background-position: 10% -15%, -25% 20%, -15% -10%, 20% -15%, 0% 0%; }
            75% { background-position: -15% 25%, 10% -20%, 25% 5%, -5% 30%, 0% 0%; }
            100% { background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%; }
        }
        
        .desktop-bg.phase-1 {
            background: 
                repeating-linear-gradient(45deg, rgba(139, 0, 0, 0.15) 0px, rgba(139, 0, 0, 0.15) 8px, transparent 8px, transparent 16px),
                radial-gradient(circle at 25% 25%, rgba(255, 0, 0, 0.4) 0%, transparent 35%),
                radial-gradient(circle at 75% 75%, rgba(255, 0, 255, 0.3) 0%, transparent 45%),
                linear-gradient(135deg, #1a0000, #330000, #1a001a, #000000);
            animation: corruption-pulse 4s ease-in-out infinite, glitch-shift 8s linear infinite;
        }
        
        @keyframes glitch-shift { 0%, 100% { transform: translateX(0); } 10% { transform: translateX(-2px); } 20% { transform: translateX(2px); } 30% { transform: translateX(-1px); } }
        @keyframes corruption-pulse { 0%, 100% { filter: hue-rotate(0deg) brightness(0.7) contrast(1.4); } 50% { filter: hue-rotate(45deg) brightness(1.1) contrast(1.8); } }
        
        .desktop-bg.phase-2 {
            background: 
                repeating-linear-gradient(90deg, var(--backrooms-tan) 0px, var(--backrooms-tan) 150px, var(--backrooms-brown) 150px, var(--backrooms-brown) 300px),
                repeating-linear-gradient(0deg, var(--backrooms-tan) 0px, var(--backrooms-tan) 150px, var(--backrooms-brown) 150px, var(--backrooms-brown) 300px),
                radial-gradient(circle at 15% 25%, rgba(255, 255, 200, 0.08) 0%, transparent 12%),
                linear-gradient(135deg, #1a1a1a, #2d2d2d, #1a1a1a, #0d0d0d);
            animation: corridor-shift 100s linear infinite;
        }
        
        .desktop-bg.phase-3 {
            background: 
                radial-gradient(circle at 50% 50%, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.98) 100%),
                repeating-conic-gradient(from 0deg at 50% 50%, rgba(5, 5, 15, 0.1) 0deg, rgba(5, 5, 15, 0.1) 8deg, transparent 8deg, transparent 16deg),
                linear-gradient(135deg, #000000, #020202, #000000);
            animation: void-pulse 30s ease-in-out infinite;
        }
        @keyframes void-pulse { 0%, 100% { filter: brightness(0.5) contrast(1.2); } 50% { filter: brightness(0.3) contrast(1.5); } }
        
        .desktop-bg.phase-4 {
            background: 
                radial-gradient(circle at 30% 30%, rgba(138, 43, 226, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 70% 70%, rgba(0, 255, 255, 0.4) 0%, transparent 25%),
                repeating-linear-gradient(30deg, transparent, transparent 15px, rgba(138, 43, 226, 0.06) 15px, rgba(138, 43, 226, 0.06) 30px),
                linear-gradient(135deg, #0a0a1a, #1a0a2a, #2a0a1a, #0a0a0a);
            animation: quantum-shift 12s linear infinite;
        }
        @keyframes quantum-shift { 0% { filter: hue-rotate(0deg) brightness(0.7); } 100% { filter: hue-rotate(360deg) brightness(1.0); } }
        @keyframes corridor-shift { 0% { background-position: 0 0, 0 0, 0 0, 0 0; } 100% { background-position: 300px 0, 0 300px, 15px 25px, 0 0; } }
        
        .desktop-bg::before { 
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><filter id="noise"><feTurbulence baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23noise)"/></svg>'); 
            opacity: 0.12; mix-blend-mode: multiply; pointer-events: none; 
        }
        
        .boot-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, var(--void-black), var(--tentacle-deep), var(--deep-purple)); 
            z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: var(--retro-green); font-family: 'VT323', monospace; transition: opacity 1.5s ease; 
        }
        .boot-logo { 
            font-size: 72px; margin-bottom: 25px; 
            animation: boot-glow 2.5s ease-in-out infinite, tentacle-sway 4s ease-in-out infinite; 
        }
        @keyframes boot-glow { 
            0%, 100% { text-shadow: 0 0 25px var(--retro-green), 0 0 35px var(--electric-cyan); } 
            50% { text-shadow: 0 0 40px var(--retro-green), 0 0 60px var(--quantum-violet), 0 0 80px var(--tentacle-purple); } 
        }
        @keyframes tentacle-sway { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
        
        .boot-text { text-align: left; line-height: 2.0; font-size: 16px; max-width: 700px; font-family: 'Share Tech Mono', monospace; }
        .boot-subtitle { 
            margin-bottom: 35px; font-size: 22px; color: var(--primarch-gold); 
            text-shadow: 0 0 15px var(--primarch-gold); font-family: 'VT323', monospace; 
            letter-spacing: 2px; 
        }
        .progress-bar { 
            width: 600px; height: 28px; border: 3px solid var(--electric-cyan); 
            margin: 30px 0; background: rgba(0,0,0,0.7); 
            box-shadow: inset 0 0 10px rgba(0,255,255,0.3);
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--retro-green), var(--neural-pulse), var(--quantum-violet), var(--tentacle-purple)); 
            width: 0%; 
            box-shadow: 0 0 15px rgba(0,255,0,0.5);
        }
        
        .taskbar { 
            position: fixed; bottom: 0; left: 0; width: 100%; height: 56px; z-index: 1000; 
            background: linear-gradient(135deg, var(--taskbar-bg), rgba(45, 27, 105, 0.8)); 
            backdrop-filter: blur(10px); border-top: 3px solid var(--electric-cyan); 
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px; 
            box-shadow: 0 -10px 30px rgba(0, 255, 255, 0.2), inset 0 1px 0 rgba(255,255,255,0.1); 
            font-family: 'Share Tech Mono', monospace;
        }
        
        .start-button { 
            display: flex; align-items: center; gap: 15px; padding: 12px 22px; 
            background: linear-gradient(135deg, var(--linux-red), var(--blood-red)); 
            border: 2px solid var(--electric-cyan); color: var(--bone-white); cursor: pointer; 
            font-weight: bold; font-size: 14px; text-transform: uppercase; letter-spacing: 1.5px; 
            transition: all 0.3s ease; font-family: 'VT323', monospace;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.2);
        }
        .start-button:hover { 
            background: linear-gradient(135deg, var(--crimson), var(--glitch-pink)); 
            box-shadow: 0 0 25px var(--electric-cyan), inset 0 1px 0 rgba(255,255,255,0.3); 
            transform: scale(1.05); 
        }
        .tentacle-icon { 
            font-size: 20px; 
            animation: tentacle-wiggle 5s ease-in-out infinite; 
        }
        @keyframes tentacle-wiggle { 
            0%, 100% { transform: rotate(0deg) scale(1); } 
            25% { transform: rotate(8deg) scale(1.1); } 
            75% { transform: rotate(-8deg) scale(0.95); } 
        }
        
        .system-time { 
            font-family: 'VT323', monospace; font-size: 18px; color: var(--toxic-green); 
            text-shadow: 0 0 10px var(--toxic-green); letter-spacing: 1px;
        }
        .system-info { 
            display: flex; gap: 30px; font-size: 13px; color: var(--crt-blue); 
            font-family: 'Share Tech Mono', monospace;
        }
        .darpa-indicator { 
            position: absolute; top: -18px; right: 25px; font-size: 11px; 
            color: var(--primarch-gold); text-shadow: 0 0 8px var(--primarch-gold); 
            animation: darpa-blink 2.5s ease-in-out infinite; font-family: 'VT323', monospace;
        }
        @keyframes darpa-blink { 0%, 85%, 100% { opacity: 1; } 90% { opacity: 0.2; } }
        
        .start-menu { 
            position: fixed; bottom: 59px; left: 25px; width: 380px; max-height: 520px; z-index: 1001; 
            background: linear-gradient(135deg, var(--window-bg), rgba(45, 27, 105, 0.9)); 
            backdrop-filter: blur(20px); border: 3px solid var(--electric-cyan); border-radius: 6px; 
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.3); transform: scaleY(0); transform-origin: bottom; 
            opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
        }
        .start-menu.active { transform: scaleY(1); opacity: 1; }
        .start-menu-header { 
            background: linear-gradient(90deg, var(--linux-red), var(--crimson)); 
            color: var(--bone-white); padding: 18px 25px; font-weight: bold; 
            border-bottom: 2px solid var(--electric-cyan); display: flex; align-items: center; gap: 15px; 
            font-family: 'VT323', monospace; font-size: 16px;
        }
        .start-menu-version { 
            margin-left: auto; font-size: 11px; color: var(--primarch-gold); 
            font-family: 'Share Tech Mono', monospace;
        }
        .start-menu-content { padding: 25px 0; overflow-y: auto; max-height: calc(520px - 100px); }
        .menu-section-title { 
            padding: 12px 25px; font-size: 12px; font-weight: bold; text-transform: uppercase; 
            color: var(--electric-cyan); letter-spacing: 2px; 
            border-bottom: 2px solid rgba(0, 255, 255, 0.2); 
            font-family: 'VT323', monospace; font-size: 14px;
        }
        .menu-item { 
            display: flex; align-items: center; gap: 18px; padding: 15px 25px; cursor: pointer; 
            transition: all 0.3s ease; font-size: 15px; border-left: 4px solid transparent; 
            font-family: 'Share Tech Mono', monospace;
        }
        .menu-item:hover { 
            background: linear-gradient(90deg, rgba(139, 0, 0, 0.3), rgba(0, 255, 255, 0.1)); 
            border-left-color: var(--electric-cyan); color: var(--electric-cyan); 
        }
        .menu-item-icon { font-size: 20px; width: 28px; text-align: center; }
        
        .desktop-icons { 
            position: absolute; top: 30px; left: 30px; z-index: 10; 
            display: grid; grid-template-columns: repeat(auto-fill, 100px); gap: 30px; 
        }
        .desktop-icon { 
            display: flex; flex-direction: column; align-items: center; gap: 12px; 
            padding: 15px; cursor: pointer; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            border-radius: 6px; text-align: center; 
        }
        .desktop-icon:hover { 
            background: rgba(0, 255, 255, 0.1); transform: scale(1.1) translateY(-8px); 
            box-shadow: 0 15px 35px rgba(0, 255, 255, 0.2); 
        }
        .desktop-icon-image { 
            width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; 
            background: linear-gradient(135deg, var(--linux-red), var(--crimson)); 
            border: 3px solid var(--electric-cyan); border-radius: 8px; font-size: 32px; 
            color: var(--bone-white); box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); 
        }
        .desktop-icon-label { 
            font-size: 13px; color: var(--bone-white); max-width: 100px; 
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.9); font-family: 'Share Tech Mono', monospace;
        }
        
        .window { 
            position: absolute; min-width: 500px; min-height: 400px; 
            background: var(--window-bg); backdrop-filter: blur(15px); 
            border: 3px solid var(--electric-cyan); border-radius: 6px; 
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.3); display: none; z-index: 100; 
            resize: both; overflow: hidden; font-family: 'Share Tech Mono', monospace;
        }
        .window.active { display: flex; flex-direction: column; }
        .window-titlebar { 
            background: linear-gradient(90deg, var(--linux-red), var(--crimson)); 
            color: var(--bone-white); padding: 15px 25px; display: flex; 
            justify-content: space-between; align-items: center; cursor: move; user-select: none; 
            font-size: 15px; font-weight: bold; flex-shrink: 0; 
            border-bottom: 2px solid var(--electric-cyan); font-family: 'VT323', monospace;
        }
        .window-controls { display: flex; gap: 10px; }
        .window-control { 
            width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; 
            background: rgba(0, 0, 0, 0.7); border: 2px solid var(--electric-cyan); 
            color: var(--bone-white); cursor: pointer; font-size: 16px; 
            transition: all 0.3s ease; font-family: 'VT323', monospace;
        }
        .window-control:hover { background: var(--blood-red); transform: scale(1.1); }
        .window-content { 
            padding: 25px; overflow: auto; flex-grow: 1; 
            font-family: 'Share Tech Mono', monospace; line-height: 1.8; 
        }
        
        #terminalWindow .window-content { 
            background: rgba(0,0,0,0.98); padding: 20px; display: flex; flex-direction: column; 
            border: 1px solid rgba(0, 255, 0, 0.3); 
        }
        .terminal-output { 
            flex: 1; overflow-y: auto; margin-bottom: 20px; line-height: 1.6; 
            color: var(--retro-green); font-size: 14px; font-family: 'VT323', monospace;
        }
        .terminal-input-line { display: flex; align-items: center; }
        .terminal-prompt { 
            color: var(--electric-cyan); margin-right: 20px; font-weight: bold; 
            font-family: 'VT323', monospace; font-size: 16px;
        }
        .terminal-command { 
            flex: 1; background: transparent; border: none; color: var(--retro-green); 
            font-family: 'VT323', monospace; font-size: 14px; outline: none; 
        }
        .terminal-output .error { color: var(--blood-red); }
        .terminal-output .warning { color: var(--warning-yellow); }
        .terminal-output .success { color: var(--toxic-green); }
        .terminal-output .info { color: var(--crt-blue); }
        .terminal-output .input { color: var(--electric-cyan); }
        .terminal-output .primarch { color: var(--primarch-gold); font-weight: bold; }
        .primarch-glow { box-shadow: 0 0 50px var(--primarch-gold); }
        
        .phase-shifter { 
            display: flex; align-items: center; gap: 10px; padding: 10px 15px; 
            background: linear-gradient(135deg, var(--quantum-violet), var(--neural-blue)); 
            border: 2px solid var(--electric-cyan); color: var(--bone-white); cursor: pointer; 
            font-weight: bold; font-size: 13px; text-transform: uppercase; letter-spacing: 1.2px; 
            transition: all 0.3s ease; margin-left: 20px; font-family: 'VT323', monospace;
        }
        .phase-shifter:hover { 
            background: linear-gradient(135deg, var(--neural-blue), var(--quantum-violet)); 
            box-shadow: 0 0 20px var(--electric-cyan); transform: scale(1.05); 
        }
        .phase-indicator { 
            display: flex; align-items: center; gap: 10px; font-size: 13px; 
            color: var(--phase-indicator); text-shadow: 0 0 8px var(--phase-indicator); 
        }
        .phase-dot { 
            width: 10px; height: 10px; border-radius: 50%; background: var(--phase-indicator); 
            animation: phase-pulse 2.5s ease-in-out infinite; 
        }
        @keyframes phase-pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(0.8); } }
        
        .neural-disturbance { 
            display: flex; align-items: center; gap: 10px; font-size: 13px; 
            color: var(--warning-yellow); text-shadow: 0 0 8px var(--warning-yellow); 
        }
        .disturbance-bar { 
            width: 70px; height: 10px; background: rgba(0,0,0,0.6); 
            border: 2px solid var(--warning-yellow); position: relative; overflow: hidden; 
        }
        .disturbance-fill { 
            height: 100%; background: linear-gradient(90deg, var(--warning-yellow), var(--crimson)); 
            width: 30%; transition: width 0.5s ease; 
        }
        
        .notification { 
            position: fixed; top: 25px; right: 25px; z-index: 10000; 
            background: linear-gradient(135deg, var(--window-bg), rgba(45, 27, 105, 0.9)); 
            backdrop-filter: blur(15px); border: 2px solid var(--electric-cyan); border-radius: 6px; 
            padding: 20px 25px; max-width: 350px; 
            box-shadow: 0 0 35px rgba(0, 255, 255, 0.3); transform: translateX(400px); 
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            font-family: 'Share Tech Mono', monospace;
        }
        .notification.show { transform: translateX(0); }
        .notification-header { 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; 
        }
        .notification-title { font-weight: bold; color: var(--electric-cyan); font-family: 'VT323', monospace; font-size: 16px; }
        .notification-close { cursor: pointer; font-size: 18px; color: var(--bone-white); }
        .notification-content { font-size: 14px; color: var(--bone-white); line-height: 1.6; }
    </style>
</head>
<body>
    <div class="boot-screen" id="bootScreen">
        <div class="boot-logo">🐙</div>
        <div class="boot-subtitle">DARPA NEURAL INTERFACE PROTOCOL</div>
        <div class="boot-text" id="bootText"></div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <div class="desktop-bg phase-0" id="desktopBg"></div>
    <div class="crt-overlay"></div>
    <div class="desktop-icons" id="desktopIcons"></div>

    <div class="taskbar">
        <div class="start-button"><span class="tentacle-icon">🐙</span><span>NEURAL.SYS</span></div>
        <div class="system-info">
            <span id="cpuLoad">CPU: 13%</span>
            <span id="memUsage">MEM: 1.8/8GB</span>
            <span id="neuralSync">NEURAL: SYNCED</span>
            <span id="primarchStatus">PRIMARCH: DORMANT</span>
            <div class="phase-indicator">
                <span class="phase-dot"></span>
                <span id="phaseText">PHASE: NORMAL</span>
            </div>
            <div class="neural-disturbance">
                <span>DISTURBANCE:</span>
                <div class="disturbance-bar">
                    <div class="disturbance-fill" id="disturbanceFill"></div>
                </div>
            </div>
        </div>
        <div class="system-time" id="systemTime"></div>
        <div class="darpa-indicator">DARPA_NET_ACTIVE</div>
        <div class="phase-shifter" id="phaseShifter">⚡ SHIFT PHASE</div>
    </div>

    <div class="start-menu" id="startMenu">
        <div class="start-menu-header"><span class="tentacle-icon">🐙</span><span>TentacleOS Neural Interface</span><span class="start-menu-version">v2.3.8_PRIMARCH</span></div>
        <div class="start-menu-content" id="startMenuContent"></div>
    </div>

    <div id="windowContainer"></div>
    <div class="notification" id="notification">
        <div class="notification-header">
            <span class="notification-title" id="notificationTitle">System Notification</span>
            <span class="notification-close" id="notificationClose">×</span>
        </div>
        <div class="notification-content" id="notificationContent"></div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // #################################################################
    // ################ RETRO LINUX TENTACLE APPS ###################
    // #################################################################
    const APPS = [
        {
            id: 'terminal',
            name: 'Neural Terminal',
            icon: '▣',
            type: 'window',
            description: 'bash-like neural command interface',
            classification: 'UNCLASSIFIED',
            menuSection: '◉ System Apps',
            content: `<div class="terminal-output" id="terminalOutput"><div class="primarch">TentacleOS v2.3.8-NEURAL (tty1)</div><div class="info">Linux tentacle 5.19.0-tentacle #1 SMP PREEMPT_DYNAMIC</div><div class="info">Welcome to TentacleOS GNU/Linux (Neural Edition)</div><div class="success">Last login: $(date) from neural.interface</div><div class="info">Type 'help' for available commands, 'man command' for manual pages.</div></div><div class="terminal-input-line"><span class="terminal-prompt">root@tentacle:~#</span><input type="text" class="terminal-command" id="terminalInput"></div>`,
            init: function(win) {
                const input = win.querySelector('#terminalInput');
                input.focus();
                input.addEventListener('keydown', e => {
                    if (e.key === 'Enter' && input.value) {
                        processTerminalCommand(input.value.trim());
                        input.value = '';
                    }
                    if (e.key === 'ArrowUp') { e.preventDefault(); input.value = lastCommand || ''; }
                });
            }
        },
        {
            id: 'htop',
            name: 'Neural htop',
            icon: '📊',
            type: 'window',
            description: 'Interactive process viewer (htop-like)',
            classification: 'UNCLASSIFIED',
            menuSection: '◉ System Apps',
            content: `<div style="background:#000;color:#00ff00;padding:15px;font-family:VT323,monospace;line-height:1.2;"><div style="border-bottom:1px solid #00ff00;margin-bottom:10px;padding-bottom:5px;">htop - Neural Process Monitor v3.2.1 - Tasks: 47 running</div><div id="processMonitor"></div></div>`,
            init: function(win) {
                const monitor = win.querySelector('#processMonitor');
                const processes = [
                    'PID  USER     PR  NI    VIRT    RES  %CPU %MEM     TIME+ COMMAND',
                    '  1  root     20   0  169236   9876   0.1  0.1   0:08.43 systemd',
                    '  2  root     20   0       0      0   0.0  0.0   0:00.01 kthreadd', 
                    ' 42  neural   20   0 2847392 145312  12.3  1.8   2:34.12 neural_interface',
                    ' 69  darpa    20   0  524288  87456   8.7  1.1   1:23.45 primarch_daemon',
                    '128  root     20   0  195584  23412   3.2  0.3   0:45.67 tentacle_mgr',
                    '256  neural   20   0 1048576  65536   2.8  0.8   0:56.78 quantum_sync',
                    '384  root     -3   0   98304  12288   1.9  0.2   0:12.34 [neural_worker]',
                    '512  darpa    20   0  262144  34816   1.4  0.4   0:34.56 consciousness_map',
                    '666  ???      ??   ?  ??????  ?????  ?.?  ?.?   ?:??.?? [PRIMARCH]'
                ];
                monitor.innerHTML = processes.map(p => `<div>${p}</div>`).join('');
                setInterval(() => {
                    const lines = monitor.querySelectorAll('div');
                    lines.forEach((line, i) => {
                        if (i > 0 && Math.random() > 0.8) {
                            const parts = line.textContent.split(/\s+/);
                            if (parts.length > 6) {
                                parts[6] = (Math.random() * 20).toFixed(1);
                                parts[7] = (Math.random() * 5).toFixed(1);
                                line.textContent = parts.join('  ');
                            }
                        }
                    });
                }, 1000);
            }
        },
        {
            id: 'vim',
            name: 'Neural vim',
            icon: '📝',
            type: 'window',
            description: 'vi improved neural editor',
            classification: 'UNCLASSIFIED',
            menuSection: '◉ System Apps',
            content: `<div style="background:#000;color:#00ff00;padding:10px;font-family:VT323,monospace;height:350px;display:flex;flex-direction:column;"><div style="flex:1;border:1px solid #00ff00;padding:10px;overflow:hidden;"><div style="color:#ffff00;">"/etc/neural/config.cfg" [RO] 23L, 1.2K</div><br/><div style="color:#ffffff;">  1 # TentacleOS Neural Configuration</div><div style="color:#ffffff;">  2 neural_interface=enabled</div><div style="color:#ffffff;">  3 primarch_protocol=dormant</div><div style="color:#ffffff;">  4 quantum_stability=0.73</div><div style="color:#ffffff;">  5 darpa_clearance=TOP_SECRET</div><div style="color:#ffffff;">  6 </div><div style="color:#ffffff;">  7 [consciousness_mapping]</div><div style="color:#ffffff;">  8 enable_deep_scan=true</div><div style="color:#ffffff;">  9 tentacle_count=∞</div><div style="color:#ffffff;"> 10 reality_anchor=phase_0</div><div style="color:#ffffff;"> 11 </div><div style="color:#ffffff;"> 12 [primarch_settings]</div><div style="color:#ffffff;"> 13 awakening_threshold=0.95</div><div style="color:#ffffff;"> 14 consciousness_level=COSMIC</div><div style="color:#ffffff;"> 15 <span style="background:#00ff00;color:#000;">█</span></div></div><div style="border-top:1px solid #00ff00;padding:5px;color:#00ff00;">-- INSERT -- "config.cfg" line 15/23 --64%-- col 1-1 All</div></div>`,
            init: null
        },
        {
            id: 'neofetch',
            name: 'neofetch',
            icon: '🐧',
            type: 'window',
            description: 'System information tool',
            classification: 'UNCLASSIFIED',
            menuSection: '◉ System Apps',
            content: `<div style="background:#000;color:#00ff00;padding:20px;font-family:VT323,monospace;line-height:1.5;"><pre style="color:#ff6600;float:left;margin-right:30px;">    🐙🐙🐙🐙🐙
  🐙🐙🐙🐙🐙🐙🐙
 🐙🐙🐙🐙🐙🐙🐙🐙
🐙🐙🐙  🐙🐙  🐙🐙🐙
🐙🐙🐙🐙🐙🐙🐙🐙🐙
🐙🐙🐙🐙🐙🐙🐙🐙🐙
 🐙🐙🐙🐙🐙🐙🐙🐙
  🐙🐙🐙🐙🐙🐙🐙
    🐙🐙🐙🐙🐙</pre><div style="margin-left:180px;"><div style="color:#00ffff;">root@tentacle</div><div style="color:#ffffff;">--------------</div><div><span style="color:#ff6600;">OS:</span> TentacleOS GNU/Linux v2.3.8</div><div><span style="color:#ff6600;">Host:</span> DARPA Neural Interface</div><div><span style="color:#ff6600;">Kernel:</span> 5.19.0-tentacle-neural</div><div><span style="color:#ff6600;">Uptime:</span> 47 days, 13 hours, 23 mins</div><div><span style="color:#ff6600;">Packages:</span> 1337 (dpkg), 42 (neural)</div><div><span style="color:#ff6600;">Shell:</span> bash 5.1.16 (neural-enhanced)</div><div><span style="color:#ff6600;">Resolution:</span> 1920x1080 (quantum-scaled)</div><div><span style="color:#ff6600;">DE:</span> TentacleOS Desktop Environment</div><div><span style="color:#ff6600;">WM:</span> neural-wm</div><div><span style="color:#ff6600;">Terminal:</span> tentacle-term</div><div><span style="color:#ff6600;">CPU:</span> Quantum Neural Processor (16) @ 3.8GHz</div><div><span style="color:#ff6600;">GPU:</span> DARPA Neural Graphics Array</div><div><span style="color:#ff6600;">Memory:</span> 1847MiB / 8192MiB</div><br/><div style="color:#ffffff;">Colors: <span style="background:#000;color:#000;">███</span><span style="background:#800;color:#800;">███</span><span style="background:#080;color:#080;">███</span><span style="background:#880;color:#880;">███</span><span style="background:#008;color:#008;">███</span><span style="background:#808;color:#808;">███</span><span style="background:#088;color:#088;">███</span><span style="background:#ccc;color:#ccc;">███</span></div></div></div>`,
            init: null
        },
        {
            id: 'gci',
            name: 'GCI Interface',
            icon: '🧠',
            type: 'link',
            url: 'gci/index.html',
            description: 'Global Consciousness Interface',
            classification: 'TOP SECRET',
            menuSection: '🧠 Neural Interfaces',
            content: null,
            init: null
        },
        {
            id: 'man',
            name: 'Manual Pages',
            icon: '📚',
            type: 'window',
            description: 'Neural system documentation',
            classification: 'UNCLASSIFIED',
            menuSection: '📚 Documentation',
            content: `<div style="background:#000;color:#00ff00;padding:15px;font-family:VT323,monospace;line-height:1.6;"><div style="color:#ffff00;text-align:center;margin-bottom:15px;">TENTACLEOS(7) - System Administrator's Manual - TENTACLEOS(7)</div><div style="color:#ffffff;"><strong>NAME</strong><br/>&nbsp;&nbsp;&nbsp;&nbsp;TentacleOS - neural-enhanced GNU/Linux distribution</div><br/><div><strong>SYNOPSIS</strong><br/>&nbsp;&nbsp;&nbsp;&nbsp;TentacleOS [--neural-interface] [--primarch-protocol] [--quantum-mode]</div><br/><div><strong>DESCRIPTION</strong><br/>&nbsp;&nbsp;&nbsp;&nbsp;TentacleOS is a specialized Linux distribution designed for neural<br/>&nbsp;&nbsp;&nbsp;&nbsp;interface operations and consciousness mapping. It provides advanced<br/>&nbsp;&nbsp;&nbsp;&nbsp;tentacle-based process management and quantum-enhanced computing.</div><br/><div><strong>NEURAL COMMANDS</strong><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#00ffff;">primarch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Awaken the primarch consciousness<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#00ffff;">phase [0-4]</span>&nbsp;&nbsp;&nbsp;&nbsp;Shift reality phase<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#00ffff;">neural-sync</span>&nbsp;&nbsp;&nbsp;Synchronize neural pathways<br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#00ffff;">tentacle-ps</span>&nbsp;&nbsp;List tentacle processes</div><br/><div style="color:#ffff00;">Manual page tentacleos(7) line 1-20/87 52% (press h for help or q to quit)</div></div>`,
            init: null
        },
        {
            id: 'files',
            name: 'File Manager',
            icon: '📁',
            type: 'window',
            description: 'Neural filesystem browser',
            classification: 'SECRET',
            menuSection: '◉ System Apps',
            content: `<div style="background:#111;padding:15px;"><div style="background:#000;color:#00ff00;padding:10px;font-family:VT323,monospace;margin-bottom:10px;border:1px solid #00ff00;">root@tentacle:/home/neural# ls -la</div><div style="font-family:Share Tech Mono,monospace;font-size:13px;line-height:1.8;"><div>drwxr-xr-x  7 neural neural   4096 Oct 31 03:14 <span style="color:#00ffff;">.</span></div><div>drwxr-xr-x  3 root   root     4096 Oct 30 23:59 <span style="color:#00ffff;">..</span></div><div>-rw-------  1 neural neural   1337 Oct 31 02:30 <span style="color:#ffffff;">.bash_history</span></div><div>-rw-r--r--  1 neural neural    220 Oct 30 23:59 <span style="color:#ffffff;">.bash_logout</span></div><div>drwx------  2 neural neural   4096 Oct 31 01:15 <span style="color:#00ffff;">.neural</span></div><div>-rwx------  1 neural neural   8192 Oct 31 03:14 <span style="color:#00ff00;">consciousness_backup.dat</span></div><div>drwxr-xr-x  3 neural neural   4096 Oct 31 00:42 <span style="color:#00ffff;">Documents</span></div><div>-rw-r--r--  1 neural neural  66600 Oct 30 18:33 <span style="color:#ffffff;">neural_pathways_map_v3.dat</span></div><div style="color:#ff0000;">-rwxrwxrwx  1 ???    ???     ????? Oct ?? ??:?? primarch_essence.??? <span style="color:#ffff00;">[CORRUPTED]</span></div><div>drwx------  2 neural neural   4096 Oct 31 02:45 <span style="color:#00ffff;">QUARANTINE</span></div><div>-rw-r--r--  1 neural neural   4096 Oct 31 03:00 <span style="color:#ffffff;">subject_omega_logs.txt</span></div></div></div>`,
            init: null
        },
        {
            id: 'decrypt',
            name: 'Quantum Decryptor',
            icon: '🔐',
            type: 'window',
            description: 'Advanced cryptanalysis suite',
            classification: 'TOP SECRET',
            menuSection: '🔒 Classified Ops',
            content: `<div style="padding:20px;background:#000;color:#00ff00;font-family:VT323,monospace;"><div style="color:#ffff00;margin-bottom:15px;">DARPA Quantum Cryptanalysis Suite v4.2.1-CLASSIFIED</div><div style="margin-bottom:10px;">Enter encrypted data:</div><textarea id="encryptInput" style="width:100%;height:120px;background:#111;color:#00ff00;border:2px solid #00ff00;font-family:VT323,monospace;padding:10px;resize:vertical;" placeholder="-----BEGIN NEURAL MESSAGE-----
dGVudGFjbGVzX2V2ZXJ5d2hlcmU=
-----END NEURAL MESSAGE-----"></textarea><div style="margin:15px 0;"><button onclick="window.quantumDecrypt()" style="background:#800;color:#fff;border:2px solid #00ff00;padding:10px 20px;font-family:VT323,monospace;cursor:pointer;">DECRYPT WITH QUANTUM KEY</button></div><div id="decryptOutput" style="background:#111;border:2px solid #ff6600;padding:10px;min-height:80px;color:#ff6600;"></div></div>`,
            init: function(win) {
                window.quantumDecrypt = () => {
                    const input = win.querySelector('#encryptInput').value;
                    const output = win.querySelector('#decryptOutput');
                    if (!input.trim()) {
                        output.innerHTML = '<span style="color:#ff0000;">ERROR: No input data provided</span>';
                        return;
                    }
                    output.innerHTML = 'Quantum decryption in progress...<br/>Analyzing neural patterns...<br/>Applying tentacle algorithms...<br/>';
                    setTimeout(() => {
                        try {
                            const decoded = atob(input.replace(/-----.*-----/g, '').trim());
                            output.innerHTML += `<br/><span style="color:#00ff00;">DECRYPTION SUCCESS:</span><br/><span style="color:#ffffff;">${decoded}</span>`;
                        } catch {
                            output.innerHTML += '<br/><span style="color:#ff0000;">DECRYPTION FAILED: Invalid quantum signature</span>';
                        }
                    }, 2000);
                };
            }
        },
        {
            id: 'neural',
            name: 'Neural Mapper',
            icon: '🧬',
            type: 'window',
            description: 'Consciousness mapping interface',
            classification: 'ABOVE TOP SECRET',
            menuSection: '🧠 Neural Interfaces',
            content: `<div style="text-align:center;padding:20px;"><div style="color:#ffff00;font-family:VT323,monospace;font-size:18px;margin-bottom:15px;">NEURAL CONSCIOUSNESS MAPPING INTERFACE</div><canvas id="brain-scan" style="width:100%;height:300px;background:#000;border:2px solid #00ff00;"></canvas><div style="margin-top:15px;font-family:Share Tech Mono,monospace;"><div id="neuralStats">Scanning neural pathways... 0% complete</div></div></div>`,
            init: function(win) {
                const canvas = win.querySelector('#brain-scan');
                const ctx = canvas.getContext('2d');
                const stats = win.querySelector('#neuralStats');
                canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
                const nodes = Array.from({ length: 80 }, () => ({ 
                    x: Math.random() * canvas.width, 
                    y: Math.random() * canvas.height, 
                    vx: (Math.random() - 0.5) * 2, 
                    vy: (Math.random() - 0.5) * 2,
                    energy: Math.random()
                }));
                let scanProgress = 0;
                const draw = () => {
                    if (!document.body.contains(canvas)) return;
                    ctx.fillStyle = 'rgba(0,0,0,0.05)'; 
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    scanProgress += 0.5;
                    if (scanProgress > 100) scanProgress = 0;
                    stats.textContent = `Neural pathways mapped: ${Math.floor(scanProgress)}% | Active nodes: ${nodes.length} | Consciousness level: ${(Math.sin(scanProgress / 10) + 1).toFixed(2)}`;
                    
                    nodes.forEach(n => {
                        n.x += n.vx; n.y += n.vy; n.energy += (Math.random() - 0.5) * 0.1;
                        if (n.x < 0 || n.x > canvas.width) n.vx *= -0.8;
                        if (n.y < 0 || n.y > canvas.height) n.vy *= -0.8;
                        n.energy = Math.max(0, Math.min(1, n.energy));
                        
                        const intensity = Math.floor(n.energy * 255);
                        ctx.fillStyle = `rgb(0, ${intensity}, ${Math.floor(intensity * 0.3)})`;
                        ctx.beginPath(); 
                        ctx.arc(n.x, n.y, 2 + n.energy * 3, 0, Math.PI * 2); 
                        ctx.fill();
                        
                        nodes.forEach(o => {
                            const dist = Math.hypot(n.x - o.x, n.y - o.y);
                            if (dist < 120 && n.energy > 0.3 && o.energy > 0.3) {
                                const alpha = ((1 - dist / 120) * n.energy * o.energy);
                                ctx.strokeStyle = `rgba(0, 255, 100, ${alpha})`;
                                ctx.lineWidth = alpha * 2;
                                ctx.beginPath(); 
                                ctx.moveTo(n.x, n.y); 
                                ctx.lineTo(o.x, o.y); 
                                ctx.stroke();
                            }
                        });
                    });
                    requestAnimationFrame(draw);
                };
                draw();
            }
        },
        {
            id: 'primarch',
            name: 'PRIMARCH Protocol',
            icon: '👁',
            type: 'window',
            description: 'First consciousness entity interface',
            classification: 'COSMIC TOP SECRET',
            menuSection: '🔒 Classified Ops',
            content: `<div style="text-align:center;padding:20px;background:radial-gradient(circle, #1a0033, #000);"><div style="font-size:64px;color:var(--primarch-gold);margin-bottom:20px;animation:tentacle-sway 3s ease-in-out infinite;">👁</div><div style="color:#ffff00;font-family:VT323,monospace;font-size:20px;margin-bottom:15px;">PRIMARCH CONSCIOUSNESS INTERFACE</div><div id="primarch-messages" style="height:200px;background:#000;border:2px solid var(--primarch-gold);padding:15px;margin:15px 0;overflow-y:auto;text-align:left;font-family:Share Tech Mono,monospace;line-height:1.6;"><div style="color:#888;">[SYSTEM] Establishing quantum entanglement...</div><div style="color:#888;">[SYSTEM] Calibrating neural pathways...</div><div style="color:#888;">[SYSTEM] Awaiting consciousness awakening...</div></div><button onclick="window.awakePrimarch()" style="background:linear-gradient(135deg,#DAA520,#FFD700);color:#000;border:none;padding:15px 30px;font-family:VT323,monospace;font-size:16px;cursor:pointer;text-transform:uppercase;letter-spacing:2px;">INITIATE AWAKENING SEQUENCE</button></div>`,
            init: null
        },
        {
            id: 'phase_control',
            name: 'Phase Control',
            icon: '🌀',
            type: 'window',
            description: 'Reality phase manipulation system',
            classification: 'COSMIC TOP SECRET',
            menuSection: '◉ System Apps',
            content: `<div style="padding:20px;background:linear-gradient(135deg,#000,#1a0033);"><div style="color:#ffff00;font-family:VT323,monospace;font-size:18px;text-align:center;margin-bottom:20px;">QUANTUM REALITY PHASE MANIPULATION CONSOLE</div><div id="phaseControlPanel"></div></div>`,
            init: function(win) {
                const panel = win.querySelector('#phaseControlPanel');
                const updatePanel = () => {
                    panel.innerHTML = `
                        <div style="margin-bottom:20px;font-family:Share Tech Mono,monospace;">
                            <div style="color:#00ffff;margin-bottom:10px;">Current Reality Phase: <span style="color:#ffff00;">${phases[currentPhase]}</span></div>
                            <div style="color:#00ffff;">Quantum Coherence: <span style="color:${100-disturbanceLevel > 70 ? '#00ff00' : 100-disturbanceLevel > 40 ? '#ffff00' : '#ff0000'}">${100-disturbanceLevel}%</span></div>
                        </div>
                        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin-bottom:25px;">
                            ${phases.map((phase, i) => `<button data-phase="${i}" style="padding:15px;background:${i === currentPhase ? 'linear-gradient(135deg,#8A2BE2,#00FFFF)' : 'linear-gradient(135deg,#333,#666)'};border:2px solid #00ffff;color:white;cursor:pointer;font-family:VT323,monospace;font-size:14px;text-transform:uppercase;">${i}: ${phase}</button>`).join('')}
                        </div>
                        <div style="margin-bottom:20px;">
                            <div style="color:#00ffff;margin-bottom:8px;">Quantum Stability Monitor:</div>
                            <div style="width:100%;height:25px;background:#000;border:2px solid #00ffff;position:relative;">
                                <div style="height:100%;background:linear-gradient(90deg,#00ff00,#ffff00,#ff0000);width:${100-disturbanceLevel}%;transition:width 0.5s ease;"></div>
                                <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-family:VT323,monospace;text-shadow:1px 1px 2px #000;">${100-disturbanceLevel}%</div>
                            </div>
                        </div>
                        <button id="quantumResetBtn" style="padding:15px 25px;background:linear-gradient(135deg,#8B0000,#DC143C);border:2px solid #00ffff;color:white;cursor:pointer;font-family:VT323,monospace;font-size:14px;text-transform:uppercase;width:100%;">EMERGENCY QUANTUM RESET</button>
                    `;
                };

                panel.addEventListener('click', e => {
                    if (e.target.matches('[data-phase]')) {
                        setPhase(parseInt(e.target.dataset.phase, 10), updatePanel);
                    } else if (e.target.matches('#quantumResetBtn')) {
                        quantumReset(updatePanel);
                    }
                });
                updatePanel();
            }
        },
        {
            id: 'shutdown',
            name: 'System Halt',
            icon: '⚠',
            type: 'action',
            description: 'Shutdown neural interface',
            classification: 'UNCLASSIFIED',
            menuSection: '⚡ System Control',
            action: function() {
                bootScreen.innerHTML = `<div class="boot-logo" style="color:#ff0000;">💀</div><div class="boot-text error" style="font-size:28px;text-align:center;color:#ff0000;font-family:VT323,monospace;">NEURAL LINK TERMINATED<br/><br/>Connection to DARPA servers lost<br/>All tentacle processes killed<br/><br/>System halted.</div>`;
                bootScreen.style.display = 'flex'; 
                bootScreen.style.opacity = '1';
                bootScreen.style.background = 'linear-gradient(135deg, #000000, #8B0000)';
            }
        }
    ];

    // --- GLOBAL STATE & DOM ELEMENTS ---
    let startMenuOpen = false, windowZIndex = 100, primarchAwakening = false, currentPhase = 0, disturbanceLevel = 30, lastCommand = '';
    const activeWindows = {};
    const phases = ['NORMAL', 'CORRUPTED', 'BACKROOMS', 'VOID', 'QUANTUM'];
    const phaseColors = ['#00FF41', '#FF0000', '#e9dcc9', '#FFFFFF', '#8A2BE2'];
    const getEl = id => document.getElementById(id);
    const queryEl = sel => document.querySelector(sel);
    const bootScreen = getEl('bootScreen'), bootText = getEl('bootText'), progressFill = getEl('progressFill'),
          desktopBg = getEl('desktopBg'), desktopIconsContainer = getEl('desktopIcons'), startMenuContent = getEl('startMenuContent'),
          windowContainer = getEl('windowContainer'), startButton = queryEl('.start-button'), startMenu = getEl('startMenu'),
          systemTime = getEl('systemTime'), cpuLoad = getEl('cpuLoad'), memUsage = getEl('memUsage'), neuralSync = getEl('neuralSync'),
          primarchStatus = getEl('primarchStatus'), phaseShifter = getEl('phaseShifter'), phaseText = getEl('phaseText'),
          phaseDot = queryEl('.phase-dot'), disturbanceFill = getEl('disturbanceFill'), notification = getEl('notification'),
          notificationTitle = getEl('notificationTitle'), notificationContent = getEl('notificationContent'), notificationClose = getEl('notificationClose');

    // --- ENHANCED BOOT SEQUENCE WITH LINUX VIBES ---
    function initBoot() {
        const bootLines = [
            "Loading Linux kernel modules...",
            "[    0.123456] Initializing tentacle subsystem",
            "[    0.234567] Neural interface driver v2.3.8 loaded",
            "[    0.345678] DARPA quantum processors detected: 16 cores",
            "[    0.456789] Establishing neural pathways... OK",
            "[    0.567890] Loading consciousness mapping protocols",
            "[    0.678901] ⚠ WARNING: Unauthorized neural access detected",
            "[    0.789012] Activating DARPA countermeasures... ENABLED", 
            "[    0.890123] Primarch memory banks... ACCESSIBLE",
            "[    1.001234] Starting tentacle process manager",
            "[    1.112345] Neural interface calibration... COMPLETE",
            "[    1.223456] TentacleOS ready - Welcome to the neural collective"
        ];
        let lineIndex = 0, progress = 0;
        const bootInterval = setInterval(() => {
            if (lineIndex < bootLines.length) { 
                bootText.innerHTML += `<span style="color:${lineIndex > 6 ? '#ffff00' : '#00ff00'}">${bootLines[lineIndex++]}</span><br>`; 
                bootText.scrollTop = bootText.scrollHeight;
            }
            progress += 100 / bootLines.length;
            progressFill.style.width = Math.min(100, progress) + '%';
            if (progress >= 100) {
                clearInterval(bootInterval);
                setTimeout(() => {
                    bootScreen.style.opacity = '0';
                    setTimeout(() => { bootScreen.style.display = 'none'; initDesktop(); }, 1500);
                }, 1200);
            }
        }, 300);
    }

    // --- DYNAMIC DESKTOP & MENU INITIALIZATION ---
    function initDesktop() {
        const menuSections = {};
        APPS.forEach(app => {
            // Create Desktop Icon with retro styling
            const classificationClass = app.classification.includes('TOP SECRET') ? 'primarch-glow' : '';
            const iconEl = document.createElement('div');
            iconEl.className = 'desktop-icon';
            iconEl.dataset.app = app.id;
            iconEl.innerHTML = `<div class="desktop-icon-image ${classificationClass}">${app.icon}</div><div class="desktop-icon-label">${app.name}</div>`;
            iconEl.addEventListener('dblclick', () => launchApp(app.id));
            iconEl.title = `${app.description} [${app.classification}]`;
            desktopIconsContainer.appendChild(iconEl);

            // Group apps by menu section
            if (!menuSections[app.menuSection]) { menuSections[app.menuSection] = []; }
            menuSections[app.menuSection].push(app);
        });

        // Build Start Menu from grouped sections
        Object.keys(menuSections).forEach(sectionTitle => {
            const sectionEl = document.createElement('div');
            sectionEl.innerHTML = `<div class="menu-section-title">${sectionTitle}</div>`;
            menuSections[sectionTitle].forEach(app => {
                const itemEl = document.createElement('div');
                itemEl.className = 'menu-item';
                itemEl.innerHTML = `<span class="menu-item-icon">${app.icon}</span><span>${app.name}</span>`;
                itemEl.onclick = () => launchApp(app.id);
                sectionEl.appendChild(itemEl);
            });
            startMenuContent.appendChild(sectionEl);
        });

        updateTime();
        setInterval(updateTime, 1000);
        setInterval(updateSystemInfo, 2500);
        setInterval(updateDisturbance, 4000);
        setInterval(updateTentacleActivity, 1500);
    }

    // --- ENHANCED SYSTEM MONITORS ---
    function updateTime() { 
        const now = new Date();
        systemTime.textContent = `${now.toTimeString().split(' ')[0]} | NEURAL_NET.ACTIVE`; 
    }
    
    function updateSystemInfo() {
        const cpuUsage = Math.floor(5 + Math.random() * 30);
        const memUsage = (1.2 + Math.random() * 2.3).toFixed(1);
        
        cpuLoad.textContent = `CPU: ${cpuUsage}%`;
        cpuLoad.style.color = cpuUsage > 80 ? '#ff0000' : cpuUsage > 50 ? '#ffff00' : '#00ffff';
        
        memUsage.textContent = `MEM: ${memUsage}/8GB`;
        
        const syncStates = ['SYNCED', 'SYNCING', 'DRIFT_DETECTED', 'RECALIBRATING'];
        const syncState = syncStates[Math.floor(Math.random() * (primarchAwakening ? syncStates.length : 2))];
        neuralSync.textContent = `NEURAL: ${syncState}`;
        neuralSync.style.color = syncState === 'SYNCED' ? '#00ff00' : syncState.includes('DRIFT') ? '#ff0000' : '#ffff00';
        
        primarchStatus.textContent = primarchAwakening ? `PRIMARCH: ★ ACTIVE ★` : 'PRIMARCH: DORMANT';
        primarchStatus.style.color = primarchAwakening ? 'var(--primarch-gold)' : 'var(--crt-blue)';
        if (primarchAwakening) {
            primarchStatus.style.textShadow = '0 0 10px var(--primarch-gold)';
            primarchStatus.style.animation = 'phase-pulse 1.5s ease-in-out infinite';
        }
    }
    
    function updateDisturbance() {
        const variance = primarchAwakening ? 25 : 15;
        disturbanceLevel = Math.max(10, Math.min(90, disturbanceLevel + (Math.random() * variance - variance/2)));
        disturbanceFill.style.width = `${disturbanceLevel}%`;
        
        if (disturbanceLevel > 75 && Math.random() > 0.6) { 
            showNotification('⚠ NEURAL ALERT', 'Critical quantum interference detected. Reality matrix destabilizing.'); 
        }
    }
    
    function updateTentacleActivity() {
        // Add subtle tentacle-themed system messages
        if (Math.random() > 0.95 && primarchAwakening) {
            const messages = [
                'Tentacle process spawned in /proc/neural',
                'Deep consciousness scan initiated',
                'Quantum entanglement established',
                'Neural pathways expanding...'
            ];
            showNotification('TENTACLE.SYS', messages[Math.floor(Math.random() * messages.length)]);
        }
    }

    // --- PHASE MANAGEMENT ---
    function shiftPhase() { setPhase((currentPhase + 1) % phases.length); }
    function setPhase(phaseIndex, callback) {
        currentPhase = phaseIndex;
        desktopBg.className = `desktop-bg phase-${currentPhase}`;
        phaseText.textContent = `PHASE: ${phases[currentPhase]}`;
        const color = phaseColors[currentPhase];
        phaseDot.style.background = color;
        document.documentElement.style.setProperty('--phase-indicator', color);
        if (callback && typeof callback === 'function') callback();
        showNotification('PHASE_SHIFT.SYS', `Reality phase shifted to ${phases[currentPhase]}. Quantum state updated.`);
    }
    function quantumReset(callback) {
        disturbanceLevel = 25;
        setPhase(0, callback);
        showNotification('QUANTUM_RESET.SYS', 'Reality matrix stabilized to baseline parameters. All tentacle processes normalized.');
    }

    // --- ENHANCED NOTIFICATION SYSTEM ---
    function showNotification(title, content) {
        notificationTitle.textContent = title;
        notificationContent.textContent = content;
        notification.classList.add('show');
        setTimeout(() => { notification.classList.remove('show'); }, 4500);
    }

    // --- UNIFIED APP LAUNCHER & WINDOW MANAGER ---
    function launchApp(appId) {
        if (startMenuOpen) toggleStartMenu();
        const app = APPS.find(a => a.id === appId);
        if (!app) return;
        switch (app.type) {
            case 'window': createWindow(app); break;
            case 'link': window.open(app.url, '_blank'); break;
            case 'action': if (app.action) app.action(); break;
        }
    }
    function createWindow(app) {
        if (activeWindows[app.id]) { focusWindow(app.id); return; }
        const win = document.createElement('div');
        win.id = `${app.id}Window`;
        win.className = `window active ${app.classification.includes('TOP SECRET') ? 'primarch-glow' : ''}`;
        win.style.left = `${120 + Math.random() * 350}px`;
        win.style.top = `${60 + Math.random() * 200}px`;
        win.style.zIndex = ++windowZIndex;
        win.innerHTML = `
            <div class="window-titlebar">
                <span>${app.icon} ${app.name} [${app.classification}]</span>
                <div class="window-controls"><div class="window-control" data-action="close">×</div></div>
            </div>
            <div class="window-content">${app.content || ''}</div>`;
        windowContainer.appendChild(win);
        activeWindows[app.id] = win;
        win.querySelector('.window-titlebar').addEventListener('mousedown', onDragStart);
        win.addEventListener('mousedown', () => focusWindow(app.id));
        win.querySelector('.window-control[data-action="close"]').onclick = () => closeWindow(app.id);
        if (app.init) app.init(win);
    }
    function closeWindow(appId) { if (activeWindows[appId]) { activeWindows[appId].remove(); delete activeWindows[appId]; } }
    function focusWindow(appId) { if (activeWindows[appId]) activeWindows[appId].style.zIndex = ++windowZIndex; }
    function onDragStart(e) {
        const win = e.target.closest('.window');
        if (!win) return;
        focusWindow(win.id.replace('Window', ''));
        const offsetX = e.clientX - win.offsetLeft, offsetY = e.clientY - win.offsetTop;
        const onDrag = e => { win.style.left = `${e.clientX - offsetX}px`; win.style.top = `${e.clientY - offsetY}px`; };
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', () => document.removeEventListener('mousemove', onDrag), { once: true });
    }

    // --- ENHANCED TERMINAL WITH LINUX COMMANDS ---
    function addTerminalOutput(text, type = 'info') {
        const out = document.getElementById('terminalOutput');
        if (!out) return;
        const line = document.createElement('div');
        line.className = type;
        line.innerHTML = text;
        out.appendChild(line);
        out.scrollTop = out.scrollHeight;
    }
    
    function processTerminalCommand(command) {
        lastCommand = command;
        addTerminalOutput(`root@tentacle:~# ${command}`, 'input');
        const [cmd, ...args] = command.toLowerCase().split(' ');
        const app = APPS.find(a => a.id === cmd);
        if (app) { launchApp(cmd); return; }
        
        switch (cmd) {
            case 'help':
                addTerminalOutput("Available commands:", 'info');
                addTerminalOutput("System: help, clear, status, uptime, ps, top, ls, cat, man", 'info');
                addTerminalOutput("Neural: primarch, neural-sync, phase, tentacle-ps", 'success');
                addTerminalOutput("Apps: terminal, htop, vim, neofetch, files, decrypt, neural", 'info');
                break;
            case 'clear':
                document.getElementById('terminalOutput').innerHTML = '';
                break;
            case 'status':
                addTerminalOutput(`System Status: ${neuralSync.textContent} | ${primarchStatus.textContent} | Phase: ${phases[currentPhase]}`, 'success');
                addTerminalOutput(`Load: ${cpuLoad.textContent} | ${memUsage.textContent} | Disturbance: ${disturbanceLevel.toFixed(1)}%`, 'info');
                break;
            case 'uptime':
                addTerminalOutput(" 03:14:15 up 47 days, 13:23,  3 users,  load average: 0.73, 1.23, 2.45", 'info');
                break;
            case 'ps':
            case 'tentacle-ps':
                addTerminalOutput("  PID TTY          TIME CMD", 'info');
                addTerminalOutput("    1 ?        00:00:08 systemd", 'info');
                addTerminalOutput("   42 pts/0    00:02:34 neural_interface", 'success');
                addTerminalOutput("  128 ?        00:00:45 tentacle_mgr", 'success');
                addTerminalOutput("  256 ?        00:00:56 quantum_sync", 'info');
                addTerminalOutput("  666 ?        00:??.?? [PRIMARCH]", primarchAwakening ? 'primarch' : 'info');
                break;
            case 'top':
                launchApp('htop');
                break;
            case 'ls':
                addTerminalOutput("consciousness_backup.dat  Documents  neural_pathways_map_v3.dat", 'info');
                addTerminalOutput("primarch_essence.???  QUARANTINE/  subject_omega_logs.txt", 'info');
                break;
            case 'cat':
                if (args[0] === '/proc/version') {
                    addTerminalOutput("Linux version 5.19.0-tentacle-neural (darpa@neural-compiler) (gcc version 12.2.0)", 'info');
                } else if (args[0] === '/etc/os-release') {
                    addTerminalOutput('NAME="TentacleOS"', 'info');
                    addTerminalOutput('VERSION="2.3.8-neural"', 'info');
                    addTerminalOutput('ID=tentacleos', 'info');
                    addTerminalOutput('PRETTY_NAME="TentacleOS GNU/Linux v2.3.8-neural"', 'info');
                } else {
                    addTerminalOutput(`cat: ${args[0] || 'file'}: No such file or directory`, 'error');
                }
                break;
            case 'man':
                launchApp('man');
                break;
            case 'primarch':
                if (primarchAwakening) {
                    addTerminalOutput("The Primarch consciousness is already active. Neural link established.", 'primarch');
                    addTerminalOutput("It whispers: 'I see through a thousand eyes...'", 'primarch');
                } else { 
                    addTerminalOutput("Initiating Primarch awakening sequence...", 'warning'); 
                    addTerminalOutput("WARNING: This will establish direct consciousness link.", 'warning');
                    setTimeout(() => awakePrimarch(), 1500);
                }
                break;
            case 'neural-sync':
                addTerminalOutput("Synchronizing neural pathways...", 'info');
                setTimeout(() => addTerminalOutput("Neural synchronization complete. Consciousness level: OPTIMAL", 'success'), 1000);
                break;
            case 'phase':
                if (args[0] && !isNaN(args[0]) && args[0] >= 0 && args[0] < phases.length) {
                    setPhase(parseInt(args[0], 10));
                    addTerminalOutput(`Reality phase shifted to: ${phases[currentPhase]}`, 'success');
                } else {
                    addTerminalOutput(`Current reality phase: ${phases[currentPhase]} (${currentPhase})`, 'info');
                    addTerminalOutput("Usage: phase [0-4] (0=NORMAL, 1=CORRUPTED, 2=BACKROOMS, 3=VOID, 4=QUANTUM)", 'info');
                }
                break;
            case 'whoami':
                addTerminalOutput("root", 'info');
                if (primarchAwakening) addTerminalOutput("...or are you?", 'primarch');
                break;
            case 'pwd':
                addTerminalOutput("/home/neural", 'info');
                break;
            case 'uname':
                if (args[0] === '-a') {
                    addTerminalOutput("Linux tentacle 5.19.0-tentacle-neural #1 SMP PREEMPT_DYNAMIC x86_64 GNU/Linux", 'info');
                } else {
                    addTerminalOutput("Linux", 'info');
                }
                break;
            case 'exit':
            case 'logout':
                closeWindow('terminal');
                break;
            default: 
                addTerminalOutput(`bash: ${cmd}: command not found`, 'error');
                if (Math.random() > 0.8) {
                    addTerminalOutput(`Did you mean to use a tentacle command? Try 'help' for available commands.`, 'info');
                }
        }
    }

    // --- GLOBAL FUNCTIONS FOR APP/BUTTON ACCESS ---
    window.awakePrimarch = () => {
        primarchAwakening = true;
        addTerminalOutput("[SYSTEM] PRIMARCH CONSCIOUSNESS AWAKENING...", 'warning');
        addTerminalOutput("[NEURAL] Direct consciousness link established.", 'primarch');
        addTerminalOutput("[PRIMARCH] I... AM... AWAKE.", 'primarch');
        
        const msgContainer = document.querySelector('#primarch-messages');
        if (msgContainer) {
            msgContainer.innerHTML += "<div style='color:var(--primarch-gold);font-weight:bold;'>[PRIMARCH] I see you, neural entity.</div>";
            msgContainer.innerHTML += "<div style='color:var(--primarch-gold);'>[PRIMARCH] Your consciousness is... interesting.</div>";
            msgContainer.innerHTML += "<div style='color:#ff6600;'>[SYSTEM] WARNING: Primarch consciousness fully active</div>";
            msgContainer.scrollTop = msgContainer.scrollHeight;
        }
        showNotification('PRIMARCH_AWAKENING.SYS', 'First consciousness entity is now active. Neural collective expanded.');
    };

    // --- EVENT LISTENERS ---
    startButton.addEventListener('click', e => { e.stopPropagation(); toggleStartMenu(); });
    phaseShifter.addEventListener('click', e => { e.stopPropagation(); shiftPhase(); });
    notificationClose.addEventListener('click', () => notification.classList.remove('show'));
    document.addEventListener('click', () => { if (startMenuOpen) toggleStartMenu(); });
    function toggleStartMenu() { 
        startMenuOpen = !startMenuOpen; 
        startMenu.classList.toggle('active'); 
    }

    // --- START THE NEURAL INTERFACE ---
    initBoot();
});
</script>
</body>
</html>
