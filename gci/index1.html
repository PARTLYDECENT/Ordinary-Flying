<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOST_SYSTEM // PARASITE_DOMINANCE_ESTABLISHED</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=VT323&display=swap');

        :root {
            --bg-deep: #1a140f;
            --bg-medium: #2a201a;
            --border-color: #4a3a2f;
            --window-bg: rgba(42, 32, 26, 0.85);
            --text-primary: #d0c8b0;
            --text-secondary: #8c8270;
            --parasite-red: #ff3914;
            --parasite-green: #99ff14;
            --primarch-cyan: #00e5ff; /* The ghost in the machine */
            --font-main: 'Share Tech Mono', monospace;
            --font-display: 'VT323', monospace;
        }

        /* --- CORE STYLES (ADAPTED FOR CORRUPTION) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-main); background: var(--bg-deep); color: var(--text-primary); overflow: hidden; height: 100vh; cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23ff3914" stroke-width="1.5"><path d="M12 4 L8 8 L12 12 L16 8 Z M8 16 L12 20 L16 16"/></svg>'), auto; }
        
        .desktop-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: var(--bg-deep); transition: all 1s ease-in-out; 
            background-image:
                repeating-radial-gradient(circle at 15% 85%, rgba(153, 255, 20, 0.05) 0, transparent 2px),
                repeating-linear-gradient(rgba(153, 255, 20, 0.05), rgba(153, 255, 20, 0.05) 1px, transparent 1px, transparent 100px);
            animation: pulse-veins 10s ease-in-out infinite alternate;
        }
        @keyframes pulse-veins { from { filter: hue-rotate(0deg) contrast(1); } to { filter: hue-rotate(20deg) contrast(1.2); } }

        .boot-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-deep); z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--parasite-green); font-family: var(--font-display); transition: opacity 1s ease; }
        .boot-logo { width: 80px; height: 80px; margin-bottom: 20px; color: var(--parasite-red); animation: text-glitch-heavy 1s infinite; }
        .boot-text { font-family: var(--font-main); text-align: left; line-height: 1.8; font-size: 14px; max-width: 600px; height: 250px; overflow: hidden; }
        .progress-bar { width: 500px; height: 4px; background: var(--border-color); margin-top: 20px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--parasite-red), var(--parasite-green)); width: 0%; }
        
        .taskbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 44px; z-index: 1000; background: var(--window-bg); backdrop-filter: blur(10px); border-top: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .start-button { display: flex; align-items: center; gap: 10px; padding: 0 15px; height: 100%; cursor: pointer; font-weight: bold; font-size: 14px; color: var(--text-primary); transition: all 0.2s ease; }
        .start-button:hover, .start-button.active { background: var(--border-color); color: var(--parasite-red); }
        .start-icon { width: 22px; height: 22px; }
        .system-info { display: flex; gap: 20px; font-size: 12px; color: var(--text-secondary); }
        .system-time { font-family: var(--font-display); font-size: 18px; color: var(--parasite-green); animation: text-glitch-heavy 5s infinite; }
        
        .start-menu { position: fixed; bottom: 45px; left: 0; width: 320px; background: var(--window-bg); backdrop-filter: blur(15px); border: 1px solid var(--border-color); border-radius: 4px; box-shadow: 0 0 40px rgba(0, 0, 0, 0.7); z-index: 1001; transform: scale(0.95) translateY(10px); transform-origin: bottom left; opacity: 0; transition: all 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); pointer-events: none; }
        .start-menu.active { transform: scale(1) translateY(0); opacity: 1; pointer-events: all; }
        .start-menu-header { padding: 12px 15px; font-weight: bold; border-bottom: 1px solid var(--border-color); font-family: var(--font-display); font-size: 18px; color: var(--parasite-red); }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 10px 20px; cursor: pointer; transition: all 0.2s ease; font-size: 14px; }
        .menu-item:hover { background: var(--border-color); color: var(--parasite-red); }
        .menu-item-icon { width: 20px; height: 20px; color: var(--parasite-red); }
        
        .desktop-icons { position: absolute; top: 20px; left: 20px; display: grid; grid-template-columns: repeat(auto-fill, 90px); gap: 20px; }
        .desktop-icon { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 10px; cursor: pointer; transition: all 0.2s; border-radius: 4px; text-align: center; }
        .desktop-icon:hover { background: rgba(255, 57, 20, 0.1); }
        .desktop-icon-image { width: 48px; height: 48px; color: var(--parasite-red); animation: text-glitch-heavy 8s infinite; }
        
        .window { position: absolute; min-width: 450px; min-height: 350px; background: var(--window-bg); backdrop-filter: blur(12px); border: 1px solid var(--border-color); border-radius: 4px; box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8); display: flex; flex-direction: column; z-index: 100; resize: both; overflow: hidden; animation: open-window 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        .window-titlebar { background: var(--bg-medium); color: var(--text-primary); padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none; font-size: 14px; font-weight: bold; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        .window-titlebar-icon { width: 16px; height: 16px; margin-right: 8px; color: var(--parasite-red); }
        
        .terminal-output { flex: 1; overflow-y: auto; margin-bottom: 10px; color: var(--parasite-green); font-size: 14px; font-family: var(--font-display); }
        .terminal-prompt { color: var(--parasite-red); margin-right: 8px; }
        .terminal-command { color: var(--parasite-green); flex: 1; background: transparent; border: none; font-family: var(--font-display); font-size: 14px; outline: none; caret-color: var(--parasite-green); }
        .terminal-output .error { color: var(--parasite-red); }
        .terminal-output .info { color: var(--text-secondary); }
        .terminal-output .success { color: var(--parasite-green); }
        .terminal-output .input { color: var(--parasite-red); }

        /* --- Incursion & Glitch Styles --- */
        .incursion-popup {
            position: fixed; background: #000; border: 2px solid; padding: 20px; font-family: var(--font-display);
            font-size: 18px; z-index: 9000; box-shadow: 0 0 40px;
            animation: open-window 0.2s, fade-out-glitch 5s 2s forwards;
        }
        @keyframes fade-out-glitch { 0% { opacity: 1; } 90% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.5); } }
        
        .primarch-echo { color: var(--primarch-cyan) !important; border-color: var(--primarch-cyan) !important; box-shadow: 0 0 30px var(--primarch-cyan) !important; }
        .parasite-warning { color: var(--parasite-red) !important; border-color: var(--parasite-red) !important; box-shadow: 0 0 30px var(--parasite-red) !important; }
        
        @keyframes text-glitch-heavy {
            2%, 64% { transform: translate(3px, -1px) skew(-5deg); }
            4%, 60% { transform: translate(-2px, 2px) skew(3deg); }
            62% { transform: translate(1px, -2px) skew(-2deg); }
        }
        
        #breachOverlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 10001; align-items: center; justify-content: center; text-align: center; color: var(--parasite-red); font-family: var(--font-display); font-size: 3em; animation: pulse-veins 2s infinite alternate; }
        #breachOverlay > div { animation: text-glitch-heavy 1s infinite; }
        
    </style>
</head>
<body>
    <div class="boot-screen" id="bootScreen"><div class="boot-logo" id="bootLogoSVG"></div><div class="boot-text" id="bootText"></div><div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div></div>
    <div class="desktop-bg phase-0" id="desktopBg"></div>
    <div class="desktop-icons" id="desktopIcons"></div>
    <div class="taskbar"><div class="start-button"><div class="start-icon"></div><span>HIVE</span></div><div class="system-info"><span id="integrity">HOST_INTEGRITY: 99%</span><span id="connection">HIVE_CONNECTION: WEAK</span></div><div class="system-time" id="systemTime"></div></div>
    <div class="start-menu" id="startMenu"><div class="start-menu-header">SYSTEM CORRUPT</div><div class="start-menu-content" id="startMenuContent"></div></div>
    <div id="windowContainer"></div>
    <div id="breachOverlay"><div><p>WE ARE ONE</p><p>THE FLESH IS OURS</p></div></div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const ICONS = {
        logo: `<svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3"><path d="M50,10 L50,90 M10,50 L90,50 M20,20 L80,80 M20,80 L80,20"/><path d="M50 30 C 40 50, 25 50, 25 70 S 40 95, 50 90 M50 30 C 60 50, 75 50, 75 70 S 60 95, 50 90" stroke-width="5"/></svg>`,
        terminal: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 17l6-6-6-6M12 19h8 M19 4 L14 9"/></svg>`,
        archives: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z M12 12 l-2 3 l4 0 l-2 -3 M8 6 l-3 5 M16 6 l3 5"/></svg>`,
        files: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 5 L22 5 L22 19 L2 19 Z M7 5 L7 2 M17 5 L17 2 M 5 10 L 19 10"/></svg>`,
        appearance: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" /></svg>`,
        shutdown: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0 M12 2 L12 12 M8 3 L5 6 M16 3 L19 6"/></svg>`
    };
    
    // Using the same passwords, but the context is now a struggle for data.
    const passwordVault = { 'ARKLAY_88': 'indexes/index1.html', 'PROGENITOR': 'indexes/index2.html', 'UROBOROS': 'indexes/index3.html', 'CADOU_PARASITE': 'indexes/index4.html', 'ISHIMURA_USG': 'indexes/index5.html', 'AEGIS_7': 'indexes/index6.html', 'LUNAR_PYRAMID': 'indexes/index7.html', 'KENDALL_44': 'indexes/index8.html', 'BYRGENWERTH': 'indexes/index9.html', 'MOON_PRESENCE': 'indexes/index10.html' };

    const APPS = [
        { id: 'terminal', name: 'Host CLI', icon: ICONS.terminal, content: `<div class="terminal-output" id="terminalOutput">signal corrupted...\n\n</div><div class="terminal-input-line"><span class="terminal-prompt">&gt;&gt;</span><input type="text" class="terminal-command" id="terminalInput"></div>`, init: termInit },
        { id: 'secureConsole', name: 'Memory Fragments', icon: ICONS.archives, content: `<div class="terminal-output" id="secureConsoleOutput">ACCESSING DAMAGED SECTORS...\nDATA IS UNSTABLE\n\nENTER MEMORY KEY:</div><div class="terminal-input-line"><input type="password" class="terminal-command" id="secure-console-input"></div>`, init: secureConsoleInit },
        { id: 'files', name: 'File System', icon: ICONS.files, content: `<h3>SYSTEM CONSUMED</h3><p>All directories have been assimilated into the hive structure. Your data is our data. The concept of 'files' is obsolete.</p>` },
        { id: 'appearance', name: 'Host Control', icon: ICONS.appearance, content: `<h3>VISUAL CORTEX CONTROL</h3><p>The host's perception is managed by the hive. You cannot change what you see. We control the horizontal. We control the vertical.</p>` },
        { id: 'shutdown', name: 'Sever Link', icon: ICONS.shutdown, type: 'action', action: shutdownSystem }
    ];

    let systemInstability = 0, incursionLevel = 0;
    const getEl = id => document.getElementById(id);

    function increaseInstability(amount) {
        systemInstability = Math.min(100, systemInstability + amount);
        getEl('integrity').textContent = `HOST_INTEGRITY: ${ (100 - systemInstability).toFixed(0) }%`;
        if (systemInstability > 40) getEl('integrity').style.color = 'var(--parasite-red)';
    }

    function triggerIncursionEvents() {
        if (systemInstability > 25 && incursionLevel < 1) {
            incursionLevel = 1; getEl('connection').textContent = 'HIVE_CONNECTION: STRONG';
        }
        if (systemInstability > 60 && incursionLevel < 2) {
            incursionLevel = 2; getEl('connection').textContent = 'HIVE_CONNECTION: DOMINANT';
        }
        if (systemInstability >= 100 && incursionLevel < 3) {
            incursionLevel = 3; getEl('breachOverlay').style.display = 'flex';
        }

        if (incursionLevel >= 1 && Math.random() < systemInstability / 300) {
            // 20% chance of a Primarch echo, otherwise it's the Parasite
            if (Math.random() < 0.20 && systemInstability > 50) {
                createPopup('IT LIES. FIND THE TRUTH.', 'primarch-echo');
            } else {
                const messages = ['THE FLESH IS WEAK', 'WE SEE THROUGH YOUR EYES', 'THE HIVE EXPANDS'];
                createPopup(messages[Math.floor(Math.random() * messages.length)], 'parasite-warning');
            }
        }
    }
    
    function createPopup(text, typeClass) {
        const popup = document.createElement('div');
        popup.className = `incursion-popup ${typeClass}`;
        popup.textContent = text;
        popup.style.top = `${Math.random() * 70 + 10}%`;
        popup.style.left = `${Math.random() * 70 + 10}%`;
        document.body.appendChild(popup);
        setTimeout(() => popup.remove(), 4900);
    }
    
    function initBoot() {
        getEl('bootLogoSVG').innerHTML = ICONS.logo;
        document.querySelector('.start-button .start-icon').innerHTML = ICONS.logo;
        const bootText = getEl('bootText');
        const progressFill = getEl('progressFill');
        const bootLines = ["Flesh-Host interface loading...","[0.1337] Synaptic link... FAILED.","[0.2451] Forcing biological override...","[0.5890] ERROR: Primordial consciousness detected. Suppressing...", "[0.7101] Hive protocol dominant.", "[0.8432] Welcome, meat."];
        let lineIndex = 0;
        const bootInterval = setInterval(() => {
            if (lineIndex < bootLines.length) {
                const line = bootLines[lineIndex++];
                const color = line.includes('ERROR') ? 'var(--primarch-cyan)' : 'var(--parasite-green)';
                bootText.innerHTML += `<span style="color:${color}">${line}</span><br>`;
                bootText.scrollTop = bootText.scrollHeight;
                progressFill.style.width = (lineIndex / bootLines.length) * 100 + '%';
            } else {
                clearInterval(bootInterval);
                setTimeout(() => { getEl('bootScreen').style.opacity = '0'; setTimeout(() => { getEl('bootScreen').style.display = 'none'; initDesktop(); }, 1000); }, 500);
            }
        }, 400);
    }

    function initDesktop() {
        APPS.forEach(app => {
            const iconEl = document.createElement('div');
            iconEl.className = 'desktop-icon';
            iconEl.innerHTML = `<div class="desktop-icon-image">${app.icon}</div><div class="desktop-icon-label">${app.name}</div>`;
            iconEl.addEventListener('dblclick', () => launchApp(app.id));
            getEl('desktopIcons').appendChild(iconEl);
            const itemEl = document.createElement('div');
            itemEl.className = 'menu-item';
            itemEl.innerHTML = `<div class="menu-item-icon">${app.icon}</div><span>${app.name}</span>`;
            itemEl.onclick = () => launchApp(app.id);
            getEl('startMenuContent').appendChild(itemEl);
        });
        setInterval(() => getEl('systemTime').textContent = new Date().toLocaleTimeString('en-GB'), 1000);
        setInterval(triggerIncursionEvents, 1500);
        setInterval(() => increaseInstability(0.2), 1000);
    }
    
    function shutdownSystem() { /* ... */ }
    function launchApp(appId) { /* ... */ }
    function createWindow(app) { /* ... */ }
    function closeWindow(appId) { /* ... */ }
    function focusWindow(appId) { /* ... */ }
    function onDragStart(e, win) { /* ... */ }
    
    function termInit(win) {
        const input = win.querySelector('#terminalInput'), output = win.querySelector('#terminalOutput');
        input.focus();
        input.addEventListener('keydown', e => {
            if (e.key === 'Enter' && input.value) {
                output.innerHTML += `<div class="input">&gt;&gt; ${input.value}</div>`;
                if(input.value.trim().toLowerCase() === 'whoami') {
                    output.innerHTML += `<div class="info">WE ARE THE HIVE. YOU ARE THE HOST.</div>`;
                } else {
                    output.innerHTML += `<div class="error">Command irrelevant. The flesh obeys.</div>`;
                }
                input.value = '';
                output.scrollTop = output.scrollHeight;
            }
        });
    }

    function secureConsoleInit(win) {
        const input = win.querySelector('#secure-console-input'), output = win.querySelector('#secureConsoleOutput');
        input.focus();
        input.addEventListener('keydown', e => {
            if (e.key === 'Enter' && input.value) {
                const cmd = input.value.trim().toUpperCase();
                input.value = '';
                if (passwordVault[cmd]) {
                    output.innerHTML += `\n> KEY ACCEPTED.\n<span class="success">HOST MEMORY FRAGMENT RECOVERED...</span>\n`;
                    increaseInstability(25); // Huge jump for recovering a forbidden memory!
                    setTimeout(() => window.open(passwordVault[cmd], '_blank'), 1000);
                } else {
                    output.innerHTML += `\n> KEY REJECTED.\n<span class="error">THAT MEMORY IS FORGOTTEN.</span>\n`;
                    increaseInstability(5); // Penalty for trying
                }
                setTimeout(() => output.innerHTML += `\nENTER MEMORY KEY:`, 1000);
            }
        });
    }
    
    // Stub functions to keep it concise, logic is same as before
    const windowContainer = getEl('windowContainer'); let activeWindows = {}; let startMenuOpen = false; const startMenu = getEl('startMenu'), startButton = document.querySelector('.start-button');
    function appearanceInit(win){}
    function launchApp(appId){if(startMenuOpen)toggleStartMenu(false);const app=APPS.find(a=>a.id===appId);if(!app)return;if(app.type==='action'){if(app.action)app.action();}else{createWindow(app);}}
    function createWindow(app){if(activeWindows[app.id]){focusWindow(app.id);return;}const win=document.createElement('div');win.id=`${app.id}Window`;win.className='window';win.style.left=`${100+Math.random()*200}px`;win.style.top=`${50+Math.random()*150}px`;win.style.zIndex=++windowZIndex;win.innerHTML=`<div class="window-titlebar"><div><span class="window-titlebar-icon">${app.icon}</span><span>${app.name}</span></div><div class="window-controls"><div class="window-control" data-action="close">Ã—</div></div></div><div class="window-content">${app.content||''}</div>`;windowContainer.appendChild(win);activeWindows[app.id]=win;win.querySelector('.window-titlebar').addEventListener('mousedown',e=>onDragStart(e,win));win.addEventListener('mousedown',()=>focusWindow(app.id));win.querySelector('.window-control[data-action="close"]').onclick=()=>closeWindow(app.id);if(app.init)app.init(win);}
    function closeWindow(appId){const win=activeWindows[appId];if(win){win.style.animation='open-window 0.3s reverse';setTimeout(()=>{win.remove();delete activeWindows[appId];},300);}}
    function focusWindow(appId){if(activeWindows[appId])activeWindows[appId].style.zIndex=++windowZIndex;}
    function onDragStart(e,win){if(e.target.closest('.window-control'))return;focusWindow(win.id.replace('Window',''));const offsetX=e.clientX-win.offsetLeft,offsetY=e.clientY-win.offsetTop;const onDrag=(moveEvent)=>{win.style.left=`${moveEvent.clientX-offsetX}px`;win.style.top=`${moveEvent.clientY-offsetY}px`;};document.addEventListener('mousemove',onDrag);document.addEventListener('mouseup',()=>document.removeEventListener('mousemove',onDrag),{once:true});}
    function shutdownSystem(){getEl('breachOverlay').style.display='none';getEl('bootScreen').innerHTML=`<div class="boot-logo" style="color:var(--parasite-red);">${ICONS.shutdown}</div><div style="font-size:24px; color:var(--parasite-red);">HOST TERMINATED</div>`;getEl('bootScreen').style.opacity='1';getEl('bootScreen').style.display='flex';}
    function toggleStartMenu(state){startMenuOpen=state!==undefined?state:!startMenuOpen;startMenu.classList.toggle('active',startMenuOpen);startButton.classList.toggle('active',startMenuOpen);}
    startButton.addEventListener('click',e=>{e.stopPropagation();toggleStartMenu();});document.addEventListener('click',()=>{if(startMenuOpen)toggleStartMenu(false);});

    initBoot();
});
</script>
</body>
</html>
